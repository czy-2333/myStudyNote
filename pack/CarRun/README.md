# <center>第十九届全国大学生智能汽车竞赛---完全模型组 - 源
> 文件结构
>- .metadata 为英飞凌IDE编译生成的文件，**勿动**
>- CarRun_TWTDL_DOWN 为下位机程序源代码
>- CarRun_TWTDL_UPPER 为上位机程序源码

## 智能车工作源码介绍
### 使用的平台
- 芯片使用的为英飞凌的tc264芯片
- IDE使用的为AURIX Development Studio
- 使用了逐飞提供的开源库，以减轻开发难度
- 百度edgeboard开发板，Linux系统开发上位机
---
### 相关的内容
- 全国大学生智能汽车竞赛完全模型组，底层控制代码功能：
    - [x] 1. 电机的运动控制（速度环+电流环,电流环暂时没用）
    - [x] 2. 舵机的转向控制
    - [x] 3. 串口蓝牙的数据接收和解码（无线串口数据监视，手机蓝牙数据交换控制）
    - [x] 4. 上位机edgeboard的数据接收和解码，以实现小车的自动控制
    - [x] 5. 按键的数据读取，以进行发车及其他控制
    - [x] 6. 陀螺仪的初始化，及解算
    - [x] 7. 电池电压ADC采样，并蜂鸣器报警
---

<center> 
版本改动
</center>

V1.0
1. ...

V1.1    
1. 上下位机通信基本完成，可以实现上位机发送速度与舵机PWM值下位机接收，但是蜂鸣器与PID参数无法正常传输，可能是移植的flash不可用或者数据包不正确。 
2. 同时陀螺仪的姿态角解算还存在问题，yaw轴数据一直在大角度的漂移。（未解决，已经不再使用陀螺仪）

V1.2    
1. 代码结构优化：将实时性要求不高的功能放入cpu0中去完成，例如无线串口数据发送；将实时性要求较高的功能放入cpu1中实现，把上位机的数据接受中断和解算放入cpu1中，以及定时器中断用于电机控制的放入cpu1中。（后续测试，又将定时器中断放回cpu0了） 
2. 进行了速度环的代码编写和调试，pid参数来自于下位机修改，缺点是修改一次就要重新进行编译烧入。在输入设定目标速度的地方加入了一阶低通滤波器，存在些许的相位滞后，但是可以避免启动加速度过大对整车机械结构的伤害。
3. 各个元素区任务均已调至稳定完成，唯一的问题是模型对小偷的识别率太低，以至于救援区经常误判或不判。

V1.3    
1. 比赛准备仓促，小车从跑起来到地区赛中间只有一个多月，所以在该代码中，存在些许问题；首先，控制上连续s弯道不稳定，这个是算法上的问题，需要更换算法结构；其次，我们在决赛的时候存在小车在斑马线失去控制冲出赛道的问题，导致出现罚时情况；然后由于时间仓促，电流环和ADC采样还没有正式使用。最后，由于比赛前，后悬架机械结构出了问题，导致比赛时不得不降低速度，从而导致参数不太匹配，转弯后太抖。但是这也说明我们代码的适应性不太好，硬件出问题后对小车影响很大，代码还有很大的提升空间。希望后来人可以在我们的基础之上，更新，优化代码，加油！

---
